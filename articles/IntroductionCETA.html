<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to Cyclical Ecological Trajectory Analysis (CETA) • ecotraj</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to Cyclical Ecological Trajectory Analysis (CETA)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ecotraj</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Ecological Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionETA.html">Introduction to Ecological Trajectory Analysis (ETA)</a></li>
    <li><a class="dropdown-item" href="../articles/TransformingTrajectories.html">Transforming trajectories</a></li>
    <li><a class="dropdown-item" href="../articles/TrajectoryDistanceMetrics.html">Distance metrics for trajectory resemblance</a></li>
    <li><a class="dropdown-item" href="../articles/Dissimilarities.html">Dissimilarities in community data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Stable Isotope Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/SITA.html">Introduction to Stable Isotope Trajectory Analysis (SITA)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cyclical Ecological Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionCETA.html">Introduction to Cyclical Ecological Trajectory Analysis (CETA)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Ecological Quality Assessment</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionEQA.html">Introduction to Ecological Quality Assessment (EQA)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/ecotraj/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to Cyclical Ecological Trajectory Analysis (CETA)</h1>
                        <h4 data-toc-skip class="author">Nicolas
Djeghri/Miquel De Cáceres</h4>
            
            <h4 data-toc-skip class="date">2025-04-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/ecotraj/blob/HEAD/vignettes/IntroductionCETA.Rmd" class="external-link"><code>vignettes/IntroductionCETA.Rmd</code></a></small>
      <div class="d-none name"><code>IntroductionCETA.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="going-round-in-cycles-but-go-somewhere-what-ceta-does-and-where-it-sits">1.1 Going round in cycles, but go somewhere! What CETA does, and
where it sits<a class="anchor" aria-label="anchor" href="#going-round-in-cycles-but-go-somewhere-what-ceta-does-and-where-it-sits"></a>
</h3>
<p><em>Cyclical Ecological Trajectory Analysis</em> (CETA) is an
extension of <em>Ecological Trajectory Analysis</em> (ETA) allowing it
to handle trajectories presenting regular cyclical dynamics
(e.g. seasons, day-night cycle):</p>
<ul>
<li>Djeghri et al. (in preparation) Going round in cycles, but going
somewhere: Ecological Trajectory Analysis as a tool to decipher
seasonality and other cyclical dynamics.</li>
</ul>
<p>Before starting, it is important to clarify what CETA does and what
it does not, as well as what we mean by <em>regular cyclical
dynamics</em>.</p>
<p>Unlike many statistical procedures dedicated to time series, CETA
does not aims to detect cyclicity. Rather, CETA aims at describing it
and gaining insights into long-term changes in cyclical dynamics.
Cyclicity must be known <em>a priori</em> from knowledge of the system
under study or from another statistical analysis (e.g. eigenvector
maps).</p>
<p>By “regular cyclical dynamics” we mean cycles that are ‒ <em>most
often</em> ‒ the product of the very regularly paced astronomic forcings
(seasons, day-night cycles, tides). Describing seasonal dynamics was in
fact the prime motivation in designing CETA. CETA is therefore not
designed to address many other dynamics that ecologists would refer to
as “cyclical” such as disturbance-recovery cycles, because the time
duration of those cycles is not fixed (i.e. they are not periodic).
These may be better addressed with clever use of the more general ETA
framework. The primary research field we envision for CETA lies in a
middle ground between phenology, community, and ecosystem ecology.</p>
</div>
<div class="section level3">
<h3 id="about-this-vignette">1.2 About this vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h3>
<p>In this vignette you will learn how to use the specific functions
designed for CETA, and how to combine them with the wider ETA framework
to obtain metrics describing cyclical trajectories.<br>
Let’s first call the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/ecotraj/">ecotraj</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Rcpp</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="general-approach-of-ceta">2. General approach of CETA<a class="anchor" aria-label="anchor" href="#general-approach-of-ceta"></a>
</h2>
<div class="section level3">
<h3 id="the-vocabulary-of-ceta">2.1 The vocabulary of CETA<a class="anchor" aria-label="anchor" href="#the-vocabulary-of-ceta"></a>
</h3>
<p>CETA is perhaps a bit heavy-handed on the vocabulary. We have two
words for time and recognize no less than three different types of
trajectories! Let’s start with the way we refer to time: CETA
distinguishes “<strong>times</strong>”, representing linear time, and
“<strong>dates</strong>” representing circular time. For instance, the
17th of December recurs every year, in that sense, we call it a date.
However, the 17th of December 2009 occurred only once (<a href="https://www.youtube.com/watch?v=AmPN8MPw2dk" class="external-link">and BBC radio is
grateful</a>). Then, there is the three types of trajectories that CETA
distinguishes and characterizes:</p>
<ul>
<li>
<strong>Cyclical trajectories</strong>: Long trajectories presenting
cyclical dynamics of a given periodicity (e.g. annual). They are the
basis of CETA. They also constitute the inputs from which the two other
types of trajectories will be derived.</li>
<li>
<strong>Cycles</strong>: Sub-divisions of a cyclical trajectory of
duration equal to its periodicity.</li>
<li>
<strong>Fixed-date trajectories</strong>: Trajectories joining the
ecological states sampled at the same date in a given cyclical
trajectory (for instance, in a multi-annual monthly sampled time series,
the trajectory joining the ecological states obtained for March of year
1, March of year 2, etc…).</li>
</ul>
<p>All this vocabulary helps CETA being a little more time-explicit than
regular ETA. Let’s build a toy dataset with <strong>one cyclical
trajectory</strong> composed of <strong>three cycles</strong> to make
this more visual:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Let's define our toy sampling times:</span></span>
<span><span class="va">timesToy</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span> <span class="co">#The sampling times of the time series</span></span>
<span><span class="va">cycleDurationToy</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co">#The duration of the cycles (i.e. the periodicity of the time series)</span></span>
<span><span class="va">datesToy</span> <span class="op">&lt;-</span> <span class="va">timesToy</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="va">cycleDurationToy</span> <span class="co">#The dates associated to each times</span></span>
<span></span>
<span><span class="co">#And state where the sampling occurred, for now let's only use one site "A"</span></span>
<span><span class="va">sitesToy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">timesToy</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Then prepare some toy data:</span></span>
<span><span class="co">#Prepare a noise and trend term to make the data more interesting</span></span>
<span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span></span>
<span><span class="co">#Make cyclical data (note that we apply the trend only to x):</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="op">(</span><span class="va">timesToy</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">/</span><span class="va">cycleDurationToy</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">timesToy</span><span class="op">)</span>,mean<span class="op">=</span><span class="fl">0</span>,sd<span class="op">=</span><span class="va">noise</span><span class="op">)</span><span class="op">+</span><span class="va">trend</span><span class="op">*</span><span class="va">timesToy</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="op">(</span><span class="va">timesToy</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">/</span><span class="va">cycleDurationToy</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">timesToy</span><span class="op">)</span>,mean<span class="op">=</span><span class="fl">0</span>,sd<span class="op">=</span><span class="va">noise</span><span class="op">)</span></span>
<span><span class="va">matToy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#And express it as a distance matrix (ETA is based on distances, increasing its generality)</span></span>
<span><span class="va">dToy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">matToy</span><span class="op">)</span></span></code></pre></div>
<p>As with classical ETA, we define the cyclical trajectory using
<code><a href="../reference/defineTrajectories.html">defineTrajectories()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xToy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span><span class="va">dToy</span>, sites <span class="op">=</span> <span class="va">sitesToy</span>, times <span class="op">=</span> <span class="va">timesToy</span><span class="op">)</span></span></code></pre></div>
<p>Note that we did not define surveys, but added survey times as
defined in <code>timesToy</code>. We can visualize the cyclical
trajectory using the function <code><a href="../reference/trajectoryPlot.html">trajectoryPCoA()</a></code>, as we would
do for any trajectory within ETA.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPCoA</a></span><span class="op">(</span><span class="va">xToy</span>, </span>
<span>               lwd <span class="op">=</span> <span class="fl">2</span>,length <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
<p>We see that the cyclical trajectory is composed of three cycles that
are not yet explicitly identified. Similarly, the fixed-date
trajectories are not isolated. This is the goal of the “extract”
functions in CETA.</p>
</div>
<div class="section level3">
<h3 id="extracting-cycles-and-fixed-date-trajectories">2.2 Extracting cycles and fixed-date trajectories<a class="anchor" aria-label="anchor" href="#extracting-cycles-and-fixed-date-trajectories"></a>
</h3>
<p>In CETA the “extract” functions take one or more <strong>cyclical
trajectories</strong> and return a distance matrix <code>d</code> and
associated descriptors allowing to isolate <strong>cycles</strong> or
<strong>fixed-date trajectories</strong> (respectively functions
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> and
<code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code>) for further analysis.</p>
<div class="section level4">
<h4 id="fixed-date-trajectories">2.2.1 Fixed-date trajectories<a class="anchor" aria-label="anchor" href="#fixed-date-trajectories"></a>
</h4>
<p>Let’s start with <code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code> as it is
the simplest one to handle:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fdtrajToy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories</a></span><span class="op">(</span><span class="va">xToy</span>,</span>
<span>                                          cycleDuration <span class="op">=</span> <span class="va">cycleDurationToy</span>,</span>
<span>                                          namesFixedDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that we haven’t specified <code>datesToy</code> as a value for
argument <code>dates</code>. This is because the CETA functions assume
default values <code>times%%cycleDuration</code> which means the taking
the modulo of cycle duration and works perfectly fine here. In cases
there is an offset between dates and times (e.g. times = 0 does not
correspond to dates = 0), a different <code>dates</code> argument must
be provided.</p>
<p>Let’s look at the output given by
<code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fdtrajToy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "fd.trajectories" "trajectories"    "list"</span></span></code></pre>
<p>The class <code>fd.trajectories</code> identifies the object as a
subclass of <code>trajectories</code>. Its elements are the usual
ones:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fdtrajToy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "d"        "metadata"</span></span></code></pre>
<p><code>d</code> is a distance matrix and <code>metadata</code> is a
data frame containing the information necessary to read it as a
descriptor of <strong>fixed-date trajectories</strong>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fdtrajToy</span><span class="op">$</span><span class="va">metadata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   sites       fdT surveys times dates</span></span>
<span><span class="co">## 1     A A_fdT_M 1       1     0     0</span></span>
<span><span class="co">## 2     A A_fdT_M 2       1     1     1</span></span>
<span><span class="co">## 3     A A_fdT_M 3       1     2     2</span></span>
<span><span class="co">## 4     A A_fdT_M 4       1     3     3</span></span>
<span><span class="co">## 5     A A_fdT_M 5       1     4     4</span></span>
<span><span class="co">## 6     A A_fdT_M 6       1     5     5</span></span></code></pre>
<p>The column <code>fdT</code> (for fixed-date trajectories) indicates
to which fixed-date trajectories the different ecological states in
<code>d</code> belong. The names in <code>fdT</code> are built by
concatenating the site (especially useful if several cyclical
trajectories are studied in parallel) with the string <code>fdT</code>
and the name given as argument in
<code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code> (if not provided, the date
is used as default).</p>
<p>Using a combination of the new distance matrix <code>d</code> and its
descriptors in <code>metadata</code>, the output of
<code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code> can be fed in other ETA
functions to study fixed-date trajectories. Whenever the ETA functions
identify the input object as one of class <code>fd.trajectories</code>,
they use the values of <code>fdT</code> column as substitute for
<code>sites</code>. For instance we can compute the directionality of
the fixed-date trajectories using:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryDirectionality</a></span><span class="op">(</span><span class="va">fdtrajToy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  A_fdT_M 1  A_fdT_M 2  A_fdT_M 3  A_fdT_M 4  A_fdT_M 5  A_fdT_M 6  A_fdT_M 7 </span></span>
<span><span class="co">##  0.9789766  0.9960968  0.9460855  0.9766767  0.8485723  0.8511184  0.9552937 </span></span>
<span><span class="co">##  A_fdT_M 8  A_fdT_M 9 A_fdT_M 10 </span></span>
<span><span class="co">##  0.9713379  0.8373815  0.9803382</span></span></code></pre>
<p>Or the distances between fixed-date trajectories using:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryComparison.html">trajectoryDistances</a></span><span class="op">(</span><span class="va">fdtrajToy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            A_fdT_M 1 A_fdT_M 2 A_fdT_M 3 A_fdT_M 4 A_fdT_M 5 A_fdT_M 6</span></span>
<span><span class="co">## A_fdT_M 2  0.3180005                                                  </span></span>
<span><span class="co">## A_fdT_M 3  0.8994350 0.6030857                                        </span></span>
<span><span class="co">## A_fdT_M 4  1.4196563 1.1605444 0.6752462                              </span></span>
<span><span class="co">## A_fdT_M 5  1.8338956 1.6139284 1.1303706 0.5616614                    </span></span>
<span><span class="co">## A_fdT_M 6  2.0920368 1.9366669 1.5511119 1.0166316 0.5902681          </span></span>
<span><span class="co">## A_fdT_M 7  1.8289310 1.7852622 1.6034532 1.2871889 0.9288005 0.5353211</span></span>
<span><span class="co">## A_fdT_M 8  1.4378364 1.5341818 1.6299085 1.4657928 1.2942500 1.0355476</span></span>
<span><span class="co">## A_fdT_M 9  0.9246206 1.1213243 1.4635933 1.5414729 1.5853991 1.5146532</span></span>
<span><span class="co">## A_fdT_M 10 0.3281008 0.6247820 1.2423826 1.5646013 1.8388043 1.9713595</span></span>
<span><span class="co">##            A_fdT_M 7 A_fdT_M 8 A_fdT_M 9</span></span>
<span><span class="co">## A_fdT_M 2                               </span></span>
<span><span class="co">## A_fdT_M 3                               </span></span>
<span><span class="co">## A_fdT_M 4                               </span></span>
<span><span class="co">## A_fdT_M 5                               </span></span>
<span><span class="co">## A_fdT_M 6                               </span></span>
<span><span class="co">## A_fdT_M 7                               </span></span>
<span><span class="co">## A_fdT_M 8  0.5581547                    </span></span>
<span><span class="co">## A_fdT_M 9  1.0941022 0.6654062          </span></span>
<span><span class="co">## A_fdT_M 10 1.6362000 1.2111657 0.6680331</span></span></code></pre>
<p>For visualization, it is possible to use the general
<code><a href="../reference/trajectoryPlot.html">trajectoryPCoA()</a></code> function as:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPCoA</a></span><span class="op">(</span><span class="va">fdtrajToy</span>,</span>
<span>               lwd <span class="op">=</span> <span class="fl">2</span>,length <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>               traj.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span>,<span class="st">"black"</span>,<span class="st">"grey"</span>,<span class="st">"orange"</span>,<span class="st">"green3"</span>,<span class="st">"brown"</span>,<span class="st">"purple"</span>,<span class="st">"pink"</span>,<span class="st">"yellow"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"></p>
<p>But CETA provides a plotting function dedicated to fixed date
trajectories that uses a circular color palette for the fixed dates
trajectories and can represent the original cyclical trajectory:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryCyclicalPlots.html">fixedDateTrajectoryPCoA</a></span><span class="op">(</span><span class="va">fdtrajToy</span>,</span>
<span>                        lwd <span class="op">=</span> <span class="fl">2</span>, length <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Note that we find, as expected, 10 fixed-date trajectories (one for
each date of each cycle). They are all linear and pretty much parallel,
which is what we expect given the trend that we put in our toy
dataset.</p>
</div>
<div class="section level4">
<h4 id="cycles">2.2.2 Cycles<a class="anchor" aria-label="anchor" href="#cycles"></a>
</h4>
<p>Let’s now look at how extraction works for <strong>cycles</strong>.
The function <code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> works very similarly to
<code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code>. Few differences are that:
it does not allows to specify names for cycles (they are by default the
concatenation of site names and “C1”, “C2” etc…); it allows to change
the <code>startdate</code> of the cycles (for instance allowing to
flexibly choose when a cycle start: <em>e.g. an annual cycle does not
always need to start in January</em>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycleToy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryCyclical.html">extractCycles</a></span><span class="op">(</span><span class="va">xToy</span>,</span>
<span>                          cycleDuration <span class="op">=</span> <span class="va">cycleDurationToy</span><span class="op">)</span></span></code></pre></div>
<p>Just like <code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code>,
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> has outputs <code>d</code> and
<code>metadata</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cycleToy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "d"        "metadata"</span></span></code></pre>
<p>When inspecting <code>metadata</code>, we find the column
<code>cycles</code>, containing the unique names of all cycles,
analogously to column <code>fdT</code> in the output of
<code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code>. In addition and
importantly, <code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> returns the column named
<code>internal</code>, which has no analog in
<code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cycleToy</span><span class="op">$</span><span class="va">metadata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   sites cycles surveys times dates internal</span></span>
<span><span class="co">## 1     A   A_C1       1     0     0     TRUE</span></span>
<span><span class="co">## 2     A   A_C1       2     1     1     TRUE</span></span>
<span><span class="co">## 3     A   A_C1       3     2     2     TRUE</span></span>
<span><span class="co">## 4     A   A_C1       4     3     3     TRUE</span></span>
<span><span class="co">## 5     A   A_C1       5     4     4     TRUE</span></span>
<span><span class="co">## 6     A   A_C1       6     5     5     TRUE</span></span></code></pre>
<p>The <code>internal</code> column gives an information on <em>internal
vs external</em> ecological states. This is an important distinction
that solve what we call the <strong>“December-to-January segment
problem”</strong> but imposes some peculiar handling of internal or
external ecological states (generally handled automatically within ETA
and CETA functions).</p>
</div>
<div class="section level4">
<h4 id="beware-of-the-external-ecological-states-the-december-to-january-segment-problem">2.2.3 Beware of the external ecological states: the
“December-to-January segment problem”<a class="anchor" aria-label="anchor" href="#beware-of-the-external-ecological-states-the-december-to-january-segment-problem"></a>
</h4>
<p>Let’s imagine we sampled a site monthly (Jan, Feb, …, Dec) during
many years
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y+1</annotation></semantics></math>
…). How do we cut this cyclical trajectory into cycles? One possibility
is to make cycles out of the segments joining all the months of year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
from January to December (12 ecological states, joined by 11 segments).
The problem then is that the segment joining December of year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
to January of year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y+1</annotation></semantics></math>
is ignored. We can then extend the cycles to the first ecological state
of the next cycle (January of year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y+1</annotation></semantics></math>,
13 ecological states 12 segments). This correctly includes the 12
segments in the cycle but implies that the cycle contains twice the
month of January. We refer to this as the <strong>“December-to-January
segment problem”</strong>.</p>
<p>In CETA, we solve this issue by distinguishing <em>internal</em> and
<em>external</em> ecological states. In the case above, January of year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y+1</annotation></semantics></math>
would be considered <em>external</em> whereas other ecological states
would be <em>internal</em>. Broadly speaking, external ecological states
are included in computations relying on the <strong>cycle
segments</strong>, but excluded in computations relying on <strong>cycle
ecological states</strong>. More specifically the metrics and operations
in CETA that require to remove, or apply a special treatment to external
ecological states are:</p>
<ul>
<li>Centering, where internal states are used for determining cycle
center but the centering operation applies to external states as
well.</li>
<li>PCoA for visualization (when several cycles are studied, some
ecological states are duplicated and need to be removed prior to
PCoA).</li>
<li>Computation of trajectory variability, where external ecological
states must be removed.</li>
</ul>
<p><strong>All this is readily handled for you by functions
<code><a href="../reference/transformTrajectories.html">centerTrajectories()</a></code>, <code><a href="../reference/trajectoryCyclicalPlots.html">cyclePCoA()</a></code>, and
<code><a href="../reference/trajectoryMetrics.html">trajectoryVariability()</a></code>respectively, but it’s always good
to be aware of what’s going on under the hood!</strong></p>
<p>In addition, you might have ideas to study cycles outside of the
CETA/ETA framework. If so, please go ahead! But remember that most
approaches rely on the concept of points, not segments, so external
ecological states should probably be removed beforehand.</p>
<p>Let’s explore the outputs of <code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> to make all
this clearer:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Number of ecological states in the original distance matrix:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dToy</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 31</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Number of ecological states in the matrix returned by extractCycles():</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cycleToy</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 33</span></span></code></pre>
<p>Note that, in this example, the distance matrix returned by
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> describes two more ecological states than
the original distance matrix. This is because
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> duplicates ecological states if they are
shared by two cycles (coming back to the example above, January of year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y+1</annotation></semantics></math>
belongs to the cycle describing year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
AND the cycle describing year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y+1</annotation></semantics></math>).
Such duplicated ecological states exist always in an internal and an
external version. This duplication allows to easily, and correctly,
compute most of the ETA metrics for cycles such as, for instance,
distances. Whenever they identify the input object as one of class
<code>cycles</code>, the ETA functions use the values of the
<code>cycles</code> column as substitute for <code>sites</code>,
allowing to compute metrics about the cycles. For instance
distances:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryComparison.html">trajectoryDistances</a></span><span class="op">(</span><span class="va">cycleToy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           A_C1      A_C2</span></span>
<span><span class="co">## A_C2 0.5231294          </span></span>
<span><span class="co">## A_C3 0.8695007 0.5047277</span></span></code></pre>
<p>However, when visualizing through PCoA, the duplicated ecological
states must be removed. This is handled by the dedicated function
<code><a href="../reference/trajectoryCyclicalPlots.html">cyclePCoA()</a></code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryCyclicalPlots.html">cyclePCoA</a></span><span class="op">(</span><span class="va">cycleToy</span>,sites.colors<span class="op">=</span><span class="st">"orangered"</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-18-1.png" width="480" style="display: block; margin: auto;">
By default, the function applies a color gradients to cycles to
represent time: darker cycles are at the start of the time series and
clearer ones at the end.</p>
<p>It is possible to center the cycles (for instance to compare only
their shapes, irrespective of their positions). The function
<code>centerTrajectory()</code> recognizes <code>cycleToy</code>as an
object of class <code>cycles</code> and performs the centering with
appropriate handling of external ecological states:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycleToy_cent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transformTrajectories.html">centerTrajectories</a></span><span class="op">(</span><span class="va">cycleToy</span><span class="op">)</span></span></code></pre></div>
<p>Of course after centering,the distances between cycles will go
down:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryComparison.html">trajectoryDistances</a></span><span class="op">(</span><span class="va">cycleToy_cent</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            A_C1       A_C2</span></span>
<span><span class="co">## A_C2 0.14729156           </span></span>
<span><span class="co">## A_C3 0.09448688 0.12116359</span></span></code></pre>
<p>For visualization, if cycles are centered, the duplicated ecological
states will no longer overlap, so they must be retained in PCoA. This is
also handled by the function <code><a href="../reference/trajectoryCyclicalPlots.html">cyclePCoA()</a></code><strong>but the
user MUST state that the cycles have been centered:</strong></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryCyclicalPlots.html">cyclePCoA</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cycleToy_cent</span>, sites.colors <span class="op">=</span> <span class="st">"orangered"</span>, centered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-21-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="assessing-the-degree-of-convexity-in-cycles">2.3 Assessing the degree of convexity in cycles<a class="anchor" aria-label="anchor" href="#assessing-the-degree-of-convexity-in-cycles"></a>
</h3>
<p>Cycle convexity is estimated using function
<code><a href="../reference/trajectoryCyclical.html">cycleConvexity()</a></code>. This metric is the cyclical equivalent of
directionality for non-cyclical trajectories. A cycle with high
convexity is interpreted as simpler than a cycle with low convexity. Low
convexity is due to concavities or “bends” in more than two dimension
indicative of a more complex (or nosier) cyclical dynamic. Importantly,
the function <code><a href="../reference/trajectoryCyclical.html">cycleConvexity()</a></code> does not uses the outputs of
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code>. This is because the original full cyclical
trajectory is needed for computation. Instead,
<code><a href="../reference/trajectoryCyclical.html">cycleConvexity()</a></code> take the same inputs as
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code>:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryCyclical.html">cycleConvexity</a></span><span class="op">(</span><span class="va">xToy</span>,</span>
<span>               cycleDuration <span class="op">=</span> <span class="va">cycleDurationToy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      A_C1      A_C2      A_C3 </span></span>
<span><span class="co">##        NA 0.9914019 0.9915258</span></span></code></pre>
<p>Note that the function returns a <code>NA</code> for the first cycle.
This is because the function needs to associate an angle to each
internal ecological states of the cycles. Since the first cycle starts
with the first ecological state of the whole time series, its associated
angle cannot be computed, and neither the convexity of the cycle.</p>
</div>
<div class="section level3">
<h3 id="computing-cyclical-shifts-phenological-advances-and-delays">2.4 Computing cyclical shifts: phenological advances and delays<a class="anchor" aria-label="anchor" href="#computing-cyclical-shifts-phenological-advances-and-delays"></a>
</h3>
<p>A last novelty of CETA is to provide a way to generalize the concept
of phenological advances and delays for multidimensional data such as
those used in community ecology. The function that computes cyclical
shifts is <code><a href="../reference/trajectoryCyclical.html">cycleShifts()</a></code>. By default, it will estimate all
the shifts that are possible to compute on a given cyclical trajectory.
The computation relies on geometrical projection and comparison of
ecological states of interest to reference cycles. The computation time
can be long for large datasets. The function takes the same inputs as
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code>:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryCyclical.html">cycleShifts</a></span><span class="op">(</span><span class="va">xToy</span>, cycleDuration <span class="op">=</span> <span class="va">cycleDurationToy</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    sites dateCS timeCS timeRef timeScale cyclicalShift</span></span>
<span><span class="co">## 1      A      0     20      10        10    0.06323295</span></span>
<span><span class="co">## 2      A      1     21      11        10   -0.05501887</span></span>
<span><span class="co">## 3      A      2     22      12        10   -0.21375250</span></span>
<span><span class="co">## 4      A      3     23      13        10   -0.04636286</span></span>
<span><span class="co">## 5      A      4     24      14        10    0.00000000</span></span>
<span><span class="co">## 6      A      5     15       5        10    0.25169988</span></span>
<span><span class="co">## 7      A      5     25       5        20    0.08723782</span></span>
<span><span class="co">## 8      A      5     25      15        10   -0.03541132</span></span>
<span><span class="co">## 9      A      6     16       6        10   -0.04901553</span></span>
<span><span class="co">## 10     A      7     17       7        10    0.01198407</span></span>
<span><span class="co">## 11     A      8     18       8        10   -0.24314511</span></span>
<span><span class="co">## 12     A      9     19       9        10   -0.00196457</span></span></code></pre>
<p>The output gives the <code><a href="../reference/trajectoryCyclical.html">cycleShifts()</a></code> computed in the same
units as the input <code>time</code>, with positive values indicating
advance and negative values indicating delay. The other columns give
information on what exactly was compared. We will come back to this
output in the real example below.</p>
</div>
<div class="section level3">
<h3 id="summary-of-the-ceta-approach">2.5 Summary of the CETA approach<a class="anchor" aria-label="anchor" href="#summary-of-the-ceta-approach"></a>
</h3>
<p>Here is a visual summary of the CETA approach:</p>
<div class="float">
<img src="CETA_workflow.png" style="width:100.0%" alt="The CETA functions (blue) allow to format data to describe fixed-date trajectories or cycles. The outputs of functions extractFixedDateTrajectories() and extractCycles() can then be used as inputs for other ETA functions (orange) to obtain the metrics of interest. Keep in mind that functions cycleConvexity() and cycleShifts(), perhaps somewhat counter-intuitively, take the same inputs as extractCycles(). Remember also to tell cyclePCoA() whether the cycles were centered or not before plotting. Finally, beware of external ecological states when studying cycles outside of the ETA framework."><div class="figcaption">The CETA functions (blue) allow to format data
to describe fixed-date trajectories or cycles. The outputs of functions
<code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code> and
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> can then be used as inputs for other ETA
functions (orange) to obtain the metrics of interest. Keep in mind that
functions <code><a href="../reference/trajectoryCyclical.html">cycleConvexity()</a></code> and <code><a href="../reference/trajectoryCyclical.html">cycleShifts()</a></code>,
perhaps somewhat counter-intuitively, take the same inputs as
<code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code>. Remember also to tell
<code><a href="../reference/trajectoryCyclicalPlots.html">cyclePCoA()</a></code> whether the cycles were centered or not before
plotting. Finally, beware of external ecological states when studying
cycles outside of the ETA framework.</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="real-data-example-zooplankton-of-the-north-sea-1958-2021">3. Real data example: Zooplankton of the North Sea 1958-2021<a class="anchor" aria-label="anchor" href="#real-data-example-zooplankton-of-the-north-sea-1958-2021"></a>
</h2>
<div class="section level3">
<h3 id="about-the-data">3.1 About the data<a class="anchor" aria-label="anchor" href="#about-the-data"></a>
</h3>
<p>The data present here describes the zooplankton community in the
North Sea sampled by the <a href="https://www.cprsurvey.org/" class="external-link">Continuous
Plankton Recorder (CPR)</a> survey. We re-worked the raw data provided
by the CPR survey <a href="https://doi.org/10.17031/66f12be296d70" class="external-link">(DOI:
10.17031/66f12be296d70)</a> into two monthly-resolved time series of the
commonest zooplankton taxa in the Northern North Sea (<code>NNS</code>)
and the Southern North Sea (<code>SNS</code>). In our data processing,
we performed a smoothing by taking a rolling average (for each month, we
averaged 5 values: a 3 months window + the corresponding month of the
previous and next years). We finally Hellinger-transformed the abundance
data to make them amenable to ecological diversity study. Hellinger
transformation implies that only relative variations in abundances are
studied here.</p>
<p>Let’s call the data:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"northseaZoo"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">northseaZoo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Hellinger" "times"     "sites"</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">northseaZoo</span><span class="op">$</span><span class="va">times</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1958.042 1958.125 1958.208 1958.292 1958.375 1958.458</span></span></code></pre>
<p><code>northseaZoo</code> contains three elements:
<code>Hellinger</code> with the Hellinger-transformed abundances,
<code>times</code> with time expressed in years (the decimals actually
correspond to a way of encoding the months as fractions of years:
<code>1:12/12-1/24</code>), and <code>sites</code> describing whether a
community sample is from the Northern <code>NNS</code> or Southern
<code>SNS</code> North Sea.</p>
</div>
<div class="section level3">
<h3 id="get-a-dissimilarity-matrix-and-define-cyclical-trajectories">3.2 Get a dissimilarity matrix and define cyclical trajectories<a class="anchor" aria-label="anchor" href="#get-a-dissimilarity-matrix-and-define-cyclical-trajectories"></a>
</h3>
<p>ETA works from dissimilarity matrices. So a first step in analyzing
the North Sea zooplankton data is to go from the <code>Hellinger</code>
matrix to a distance matrix. Luckily for us, euclidean distances
computed on Hellinger-transformed community data yield Hellinger
distances between communities. We can therefore use the
<code>dist</code> function from base R.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">northseaZoo</span><span class="op">$</span><span class="va">Dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">northseaZoo</span><span class="op">$</span><span class="va">Hellinger</span><span class="op">)</span></span></code></pre></div>
<p>To be analyzed using ETA, the distance matrix has to be complemented
with information regarding sites and surveys to get a object of class
<code>trajectories</code> using <code><a href="../reference/defineTrajectories.html">defineTrajectories()</a></code>.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_northseaZoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">northseaZoo</span><span class="op">$</span><span class="va">Dist</span>,</span>
<span>                                    sites <span class="op">=</span> <span class="va">northseaZoo</span><span class="op">$</span><span class="va">sites</span>,</span>
<span>                                    times <span class="op">=</span> <span class="va">northseaZoo</span><span class="op">$</span><span class="va">times</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize-the-cyclical-trajectories">3.3 Visualize the cyclical trajectories<a class="anchor" aria-label="anchor" href="#visualize-the-cyclical-trajectories"></a>
</h3>
<p>From now on, if you are executing the code live, bear with us a
little bit as the time series are rather long, so your computer may need
some time to display the graphics or compute some metrics.<br>
As before, we can use the <code><a href="../reference/trajectoryPlot.html">trajectoryPCoA()</a></code> function to
display the two cyclical trajectories:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPCoA</a></span><span class="op">(</span><span class="va">x_northseaZoo</span>,</span>
<span>               traj.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,</span>
<span>               length <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topleft"</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,pch<span class="op">=</span><span class="fl">15</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">northseaZoo</span><span class="op">$</span><span class="va">sites</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-27-1.png" width="480" style="display: block; margin: auto;">
Things indeed seem to turn and present clear cycles: This is not
surprising as seasonality is a very prominent factor in driving
temperate zooplankton community dynamics. But from such a representation
it is hard to distinguish clear patterns. Let’s use CETA!</p>
</div>
<div class="section level3">
<h3 id="seasonal-cycles">3.4 Seasonal cycles<a class="anchor" aria-label="anchor" href="#seasonal-cycles"></a>
</h3>
<p>We can use the function <code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> to get data in a
format describing the seasonal cycles:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cyclesNSZoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryCyclical.html">extractCycles</a></span><span class="op">(</span><span class="va">x_northseaZoo</span>,</span>
<span>                             cycleDuration <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             minEcolStates <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#Note that we use here a cycleDuration of 1 (everything is expressed in years),</span></span>
<span><span class="co">#we also use the minEcolStates argument to say that we want to only keep cycles that</span></span>
<span><span class="co">#have at least 12 ecological states: In our case this is as complete as it gets</span></span></code></pre></div>
<p>Let’s visualize the cycles!</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryCyclicalPlots.html">cyclePCoA</a></span><span class="op">(</span><span class="va">cyclesNSZoo</span>,</span>
<span>          sites.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,</span>
<span>          length <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>          print.init.points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topleft"</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,pch<span class="op">=</span><span class="fl">15</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">northseaZoo</span><span class="op">$</span><span class="va">sites</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-29-1.png" width="480" style="display: block; margin: auto;">
It is still a very busy graph but note that some data points are not
there anymore (such as the outlier from SNS far on PCoA axis 2). This is
because we asked <code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> to only take complete
years (<code>minEcolStates = 12</code>). We can nonetheless see that
more recent years (clearer lines) seem to be moving towards negative
values of PCoA axis 2 suggesting a shift in zooplankton community
composition across the whole time series and in both parts of the North
Sea. The points (printed through argument
<code>print.init.points</code>) show cycles’ starts (in this case
January months) and help interpretation: winters are towards negative
values of PCoA 1, summers towards positive values of PCoA 1.</p>
<p>We can then use the outputs of <code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code> contained
in <code>cycleNSZoo</code> as inputs for other ETA function and assess
some interesting characteristics of the seasonal cycles of North Sea
zooplankton. For instance one can obtain cycle length:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cyclesZooLengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryLengths</a></span><span class="op">(</span><span class="va">cyclesNSZoo</span><span class="op">)</span></span></code></pre></div>
<p>And cycle convexity, remembering that this metric is not obtained
using the output of <code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code>, but using the same
inputs as for <code><a href="../reference/trajectoryCyclical.html">extractCycles()</a></code>:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cyclesZooConv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryCyclical.html">cycleConvexity</a></span><span class="op">(</span><span class="va">x_northseaZoo</span>,</span>
<span>                                  cycleDuration <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  minEcolStates <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p>Cycle length and cycle convexity help describing the shapes of cycles
in a way mirroring trajectory length and directionality in non-cyclical
ETA. Let’s graph the outputs:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#First let's build some broad descriptive statistics for individual cycles: what year, and what site?</span></span>
<span><span class="va">yearCycles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">cyclesNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span>,<span class="va">cyclesNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">cycles</span>,<span class="va">min</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sitesCycles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">cyclesNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">sites</span>,<span class="va">cyclesNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">cycles</span>,<span class="va">unique</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Doing some reordering</span></span>
<span><span class="va">yearCycles</span> <span class="op">&lt;-</span> <span class="va">yearCycles</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cyclesNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">cycles</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sitesCycles</span> <span class="op">&lt;-</span> <span class="va">sitesCycles</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cyclesNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">cycles</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#put all descriptors together</span></span>
<span><span class="va">StatCyclesZoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">sitesCycles</span>,<span class="va">yearCycles</span>,<span class="va">cyclesZooLengths</span><span class="op">$</span><span class="va">Path</span>,<span class="va">cyclesZooConv</span><span class="op">)</span></span>
<span><span class="va">SNScycles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">StatCyclesZoo</span>,<span class="va">sitesCycles</span><span class="op">==</span><span class="st">"SNS"</span><span class="op">)</span></span>
<span><span class="va">NNScycles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">StatCyclesZoo</span>,<span class="va">sitesCycles</span><span class="op">==</span><span class="st">"NNS"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#put that in the format of a complete time serie (recreating the holes if any)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">SNScycles</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">SNScycles</span><span class="op">$</span><span class="va">yearCycles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">NNScycles</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">NNScycles</span><span class="op">$</span><span class="va">yearCycles</span></span>
<span></span>
<span><span class="va">SNScycles</span> <span class="op">&lt;-</span> <span class="va">SNScycles</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1958</span><span class="op">:</span><span class="fl">2021</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">NNScycles</span> <span class="op">&lt;-</span> <span class="va">NNScycles</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1958</span><span class="op">:</span><span class="fl">2021</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#First figure: Lengths</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SNScycles</span><span class="op">$</span><span class="va">yearCycles</span>,<span class="va">SNScycles</span><span class="op">$</span><span class="va">cyclesZooLengths.Path</span>,type<span class="op">=</span><span class="st">"l"</span>,las<span class="op">=</span><span class="fl">1</span>,ylab<span class="op">=</span><span class="st">"Cycle lengths"</span>,xlab<span class="op">=</span><span class="st">"Years"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">5</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">NNScycles</span><span class="op">$</span><span class="va">yearCycles</span>,<span class="va">NNScycles</span><span class="op">$</span><span class="va">cyclesZooLengths.Path</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Second figure: Convexity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SNScycles</span><span class="op">$</span><span class="va">yearCycles</span>,<span class="va">SNScycles</span><span class="op">$</span><span class="va">cyclesZooConv</span>,type<span class="op">=</span><span class="st">"l"</span>,las<span class="op">=</span><span class="fl">1</span>,ylab<span class="op">=</span><span class="st">"Cycle convexity"</span>,xlab<span class="op">=</span><span class="st">"Years"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="fl">0.5</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">NNScycles</span><span class="op">$</span><span class="va">yearCycles</span>,<span class="va">NNScycles</span><span class="op">$</span><span class="va">cyclesZooConv</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Cycle lengths seems to have decreased in the 1980s while convexity
seems to present a “jump” around year 2000. From previous studies on the
CPR time series, it is known that regime shifts occurred in the plankton
community at those two periods. For instance, around 2000, echinoderm
larvae became seasonally dominant in the North Sea. It is possible that
the “jump” in convexity is linked to this event, as a large dominance of
one taxa in a given season would indeed pull the cycles towards one
dimension only, possibly increasing cycle convexity.</p>
<p>Let’s now look at the distances between cycles:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cyclesZooDistances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryComparison.html">trajectoryDistances</a></span><span class="op">(</span><span class="va">cyclesNSZoo</span><span class="op">)</span></span></code></pre></div>
<p>Just like distances between ecological states, distances between
cycles can be visualized by principal coordinates analysis (PCoA)
putting us in the “space of cycles”:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="va">PCoAZoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/pcoa.html" class="external-link">pcoa</a></span><span class="op">(</span><span class="va">cyclesZooDistances</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colPoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">colPoints</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SNS"</span>,<span class="st">"NNS"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">PCoAZoo</span><span class="op">$</span><span class="va">vectors</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,asp<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="cn">NA</span>,</span>
<span>     xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PCoA 1 ("</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">PCoAZoo</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">Relative_eig</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">" %)"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>     ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PCoA 2 ("</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">PCoAZoo</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">Relative_eig</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">" %)"</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">PCoAZoo</span><span class="op">$</span><span class="va">vectors</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">yearCycles</span><span class="op">)</span>,col<span class="op">=</span><span class="va">colPoints</span><span class="op">[</span><span class="va">sitesCycles</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topleft"</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,pch<span class="op">=</span><span class="fl">15</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">northseaZoo</span><span class="op">$</span><span class="va">sites</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-37-1.png" width="480" style="display: block; margin: auto;"></p>
<p>We can see from this graph that the Northern and Southern North Sea
present parallel changes in seasonal dynamics while maintaining their
differences during the whole time series. An important change seem to
have occurred around year 2000 in agreement with previous studies that
detected a regime shift around that time.</p>
<p>You know what’s fun? We now have two sets of time-ordered “ecological
states” (more ecological dynamics to be fair) defined in a distance
matrix. This is all we need to do some trajectory analysis. We can thus
perform what we call “second-order” trajectory analysis using the
distance between cycles as our distance matrix. We wont go in the
details here but here is the corresponding graph as an appetizer:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_second_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">cyclesZooDistances</span>,</span>
<span>                                     sites <span class="op">=</span> <span class="va">sitesCycles</span>,</span>
<span>                                     surveys <span class="op">=</span> <span class="va">yearCycles</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPCoA</a></span><span class="op">(</span><span class="va">x_second_order</span>,</span>
<span>               traj.colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,</span>
<span>               length<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topleft"</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,pch<span class="op">=</span><span class="fl">15</span>,<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">northseaZoo</span><span class="op">$</span><span class="va">sites</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-38-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Note that the two PCoA do not represent the same variance on their
first and second axes. This is due to differences in the correction
method used for negative eigenvalues (ignored in the first case,
application of Cailliez correction in the second case).</p>
</div>
<div class="section level3">
<h3 id="fixed-date-trajectories-1">3.5 Fixed-date trajectories<a class="anchor" aria-label="anchor" href="#fixed-date-trajectories-1"></a>
</h3>
<p>Let’s now look at the fixed-date trajectories. First prepare the data
using <code><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories()</a></code>:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fdtrajNSZoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryCyclical.html">extractFixedDateTrajectories</a></span><span class="op">(</span><span class="va">x_northseaZoo</span>,</span>
<span>                                            cycleDuration <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                            namesFixedDate <span class="op">=</span></span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Jan"</span>,<span class="st">"Feb"</span>,<span class="st">"Mar"</span>,<span class="st">"Apr"</span>,<span class="st">"May"</span>,<span class="st">"Jun"</span>,<span class="st">"Jul"</span>,<span class="st">"Aug"</span>,<span class="st">"Sep"</span>,<span class="st">"Oct"</span>,<span class="st">"Nov"</span>,<span class="st">"Dec"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then visualize the fixed date trajectories using the dedicated
function <code><a href="../reference/trajectoryCyclicalPlots.html">fixedDateTrajectoryPCoA()</a></code>:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryCyclicalPlots.html">fixedDateTrajectoryPCoA</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span>,</span>
<span>                        sites.lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-40-1.png" width="480" style="display: block; margin: auto;">
Hum, with such a big dataset, this is not the clearest graph! Let’s look
at some summary metrics instead.</p>
<p>As we did for cycles, we can compute shape metrics on fixed-date
trajectories:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fdtrajZooLengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryLengths</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span><span class="op">)</span></span>
<span><span class="va">fdtrajZooDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryDirectionality</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span><span class="op">)</span></span></code></pre></div>
<p>And put them in a convenient dataframe:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#descriptive stats</span></span>
<span><span class="va">monthFDT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">dates</span>,<span class="va">fdtrajNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">fdT</span>,<span class="va">min</span><span class="op">)</span></span>
<span><span class="va">sitesFDT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">sites</span>,<span class="va">fdtrajNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">fdT</span>,<span class="va">unique</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#reordering</span></span>
<span><span class="va">monthFDT</span> <span class="op">&lt;-</span> <span class="va">monthFDT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">fdT</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sitesFDT</span> <span class="op">&lt;-</span> <span class="va">sitesFDT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">fdT</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#put all descriptors together</span></span>
<span><span class="va">StatFDTZoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">sitesFDT</span>,<span class="va">monthFDT</span>,<span class="va">fdtrajZooLengths</span><span class="op">$</span><span class="va">Path</span>,<span class="va">fdtrajZooDir</span><span class="op">)</span></span>
<span><span class="va">SNSfdT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">StatFDTZoo</span>,<span class="va">sitesFDT</span><span class="op">==</span><span class="st">"SNS"</span><span class="op">)</span></span>
<span><span class="va">NNSfdT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">StatFDTZoo</span>,<span class="va">sitesFDT</span><span class="op">==</span><span class="st">"NNS"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#put them in month order</span></span>
<span><span class="va">SNSfdT</span> <span class="op">&lt;-</span> <span class="va">SNSfdT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">SNSfdT</span><span class="op">$</span><span class="va">monthFDT</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">NNSfdT</span> <span class="op">&lt;-</span> <span class="va">NNSfdT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">NNSfdT</span><span class="op">$</span><span class="va">monthFDT</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#and put the month in a convenient format:</span></span>
<span><span class="va">SNSfdT</span><span class="op">$</span><span class="va">monthFDT</span> <span class="op">&lt;-</span> <span class="va">SNSfdT</span><span class="op">$</span><span class="va">monthFDT</span><span class="op">*</span><span class="fl">12</span><span class="op">+</span><span class="fl">0.5</span></span>
<span><span class="va">NNSfdT</span><span class="op">$</span><span class="va">monthFDT</span> <span class="op">&lt;-</span> <span class="va">NNSfdT</span><span class="op">$</span><span class="va">monthFDT</span><span class="op">*</span><span class="fl">12</span><span class="op">+</span><span class="fl">0.5</span></span></code></pre></div>
<p>Before graphing them:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#First figure: Lengths</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SNSfdT</span><span class="op">$</span><span class="va">monthFDT</span>,<span class="va">SNSfdT</span><span class="op">$</span><span class="va">fdtrajZooLengths.Path</span>,type<span class="op">=</span><span class="st">"l"</span>,las<span class="op">=</span><span class="fl">1</span>,ylab<span class="op">=</span><span class="st">"Fixed-date trajectory lengths"</span>,xlab<span class="op">=</span><span class="st">"Month"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">25</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">NNSfdT</span><span class="op">$</span><span class="va">monthFDT</span>,<span class="va">NNSfdT</span><span class="op">$</span><span class="va">fdtrajZooLengths.Path</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-43-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Second figure: Directionality</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">SNSfdT</span><span class="op">$</span><span class="va">monthFDT</span>,<span class="va">SNSfdT</span><span class="op">$</span><span class="va">fdtrajZooDir</span>,type<span class="op">=</span><span class="st">"l"</span>,las<span class="op">=</span><span class="fl">1</span>,ylab<span class="op">=</span><span class="st">"Fixed-date trajectory directionality"</span>,xlab<span class="op">=</span><span class="st">"Years"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.36</span>,<span class="fl">0.45</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">NNSfdT</span><span class="op">$</span><span class="va">monthFDT</span>,<span class="va">NNSfdT</span><span class="op">$</span><span class="va">fdtrajZooDir</span>,type<span class="op">=</span><span class="st">"l"</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-44-1.png" width="672" style="display: block; margin: auto;"></p>
<p>There is tendency of fixed-date trajectories to have high
directionality and low length in summer months and conversely in winter.
This is likely to be a sampling effect. Although the sampling effort is
rather continuous throughout the year in CPR data, winter zooplankton
communities are less abundant making their measured composition more
stochastic. This is reflected in noisier fixed-date trajectories in
winter.</p>
<p>Nonetheless, a metric of peculiar interest in fixed-date trajectories
might be convergence:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#We will do it for the two sites (NNS and SNS) separately, so lets pull them apart</span></span>
<span><span class="va">SNSfdtraj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsetTrajectories.html">subsetTrajectories</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span>,site_selection <span class="op">=</span> <span class="st">"SNS"</span><span class="op">)</span></span>
<span><span class="va">NNSfdtraj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsetTrajectories.html">subsetTrajectories</a></span><span class="op">(</span><span class="va">fdtrajNSZoo</span>,site_selection <span class="op">=</span> <span class="st">"NNS"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Then we need to keep only the years during which the fixed-date trajectories all have associated ecological states (this is because we want to perform a symmetric convergence test)</span></span>
<span><span class="va">selecSNS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span><span class="op">-</span><span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">dates</span><span class="op">)</span><span class="op">==</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">selecNNS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span><span class="op">-</span><span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">dates</span><span class="op">)</span><span class="op">==</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#change the distance matrices</span></span>
<span><span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">selecSNS</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">selecSNS</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">selecNNS</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">selecNNS</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># and change metadata</span></span>
<span><span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">SNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">selecSNS</span>,<span class="op">]</span></span>
<span><span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">NNSfdtraj</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">times</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">selecNNS</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#Now we can compute the convergence!</span></span>
<span><span class="va">SNSfdtrajConv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryComparison.html">trajectoryConvergence</a></span><span class="op">(</span><span class="va">SNSfdtraj</span>,</span>
<span>                                       symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">NNSfdtrajConv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryComparison.html">trajectoryConvergence</a></span><span class="op">(</span><span class="va">NNSfdtraj</span>,</span>
<span>                                       symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot" class="external-link">corrplot</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## corrplot 0.95 loaded</span></span></code></pre>
<p>Let’s now visualize it for SNS:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">SNSfdtrajConv</span><span class="op">$</span><span class="va">tau</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">SNSfdtrajConv</span><span class="op">$</span><span class="va">p.value</span><span class="op">&lt;</span><span class="fl">0.05</span><span class="op">)</span>,<span class="fl">12</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-46-1.png" width="480" style="display: block; margin: auto;">
And for NNS:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">NNSfdtrajConv</span><span class="op">$</span><span class="va">tau</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">NNSfdtrajConv</span><span class="op">$</span><span class="va">p.value</span><span class="op">&lt;</span><span class="fl">0.05</span><span class="op">)</span>,<span class="fl">12</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-47-1.png" width="480" style="display: block; margin: auto;">
In those graphs, blue indicates divergence while red indicates
convergence of fixed date tajectories. In both part of the North Sea, we
see a convergence of spring and summer months and a divergence winter
month with summer months. One possible interpretation is that summers
and winters are getting more contrasted.</p>
</div>
<div class="section level3">
<h3 id="advances-and-delays-in-community-composition">3.6 Advances and delays in community composition<a class="anchor" aria-label="anchor" href="#advances-and-delays-in-community-composition"></a>
</h3>
<p>The last aspect that CETA allows to investigate is cyclical shifts
(e.g. advances and delays similar to approaches in phenology). The
function that does it is <code><a href="../reference/trajectoryCyclical.html">cycleShifts()</a></code>. This one will take
a bit long to compute, it works a lot!</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CSNSZoo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryCyclical.html">cycleShifts</a></span><span class="op">(</span><span class="va">x_northseaZoo</span>,</span>
<span>                       cycleDuration <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">CSNSZoo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   sites     dateCS   timeCS  timeRef timeScale cyclicalShift</span></span>
<span><span class="co">## 1   NNS 0.04166667 1960.042 1959.042         1   0.025631729</span></span>
<span><span class="co">## 2   NNS 0.04166667 1961.042 1959.042         2   0.021382801</span></span>
<span><span class="co">## 3   NNS 0.04166667 1962.042 1959.042         3   0.061321501</span></span>
<span><span class="co">## 4   NNS 0.04166667 1963.042 1959.042         4   0.020736485</span></span>
<span><span class="co">## 5   NNS 0.04166667 1964.042 1959.042         5  -0.001200648</span></span>
<span><span class="co">## 6   NNS 0.04166667 1965.042 1959.042         6  -0.017846575</span></span></code></pre>
<p>Broadly, <code><a href="../reference/trajectoryCyclical.html">cycleShifts()</a></code> works by compute
<code>cyclicalShift</code> by comparing <strong>the position of an
ecological state of interest on its cycle</strong> (at a date
<code>dateCS</code>,and time <code>timeCS</code>) to <strong>the
position of the ecological state of same date on a reference
cycle</strong> (at time <code>timeRef</code>). The two ecological states
are separated by an amount of time <code>timeScale</code>. Which cycles
to choose to compute a cyclical shift can be rather arbitrary so instead
we can simply use all possible comparison and extract a trend from a
graph of <code>cyclicalShift</code> against <code>timeScale</code>. We
do it below for all dates (i.e. months of the year) and display only one
of the graphs as an example:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SNS"</span>,<span class="st">"NNS"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">CSNSZoo</span><span class="op">$</span><span class="va">dateCS</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">#prepare the relevant subset</span></span>
<span>    <span class="va">subsetCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">CSNSZoo</span>,<span class="va">sites</span><span class="op">==</span><span class="va">i</span><span class="op">)</span><span class="op">|&gt;</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dateCS</span><span class="op">==</span><span class="va">j</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#compute a slope</span></span>
<span>    <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="op">(</span><span class="va">subsetCS</span><span class="op">$</span><span class="va">cyclicalShift</span><span class="op">*</span><span class="fl">365</span><span class="op">)</span><span class="op">~</span><span class="va">subsetCS</span><span class="op">$</span><span class="va">timeScale</span><span class="op">)</span></span>
<span>    <span class="co">#Note that we multiply the shift by 365 to get in days</span></span>
<span>    <span class="va">sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span>    <span class="va">slopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">slopes</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">model</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="st">"NNS"</span><span class="op">&amp;</span><span class="va">j</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">CSNSZoo</span><span class="op">$</span><span class="va">dateCS</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">subsetCS</span><span class="op">$</span><span class="va">timeScale</span>,y<span class="op">=</span><span class="va">subsetCS</span><span class="op">$</span><span class="va">cyclicalShift</span><span class="op">*</span><span class="fl">365</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">182.5</span>,<span class="fl">182.5</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span>,</span>
<span>       las<span class="op">=</span><span class="fl">1</span>,</span>
<span>       pch<span class="op">=</span><span class="fl">16</span>,</span>
<span>       xlab<span class="op">=</span><span class="st">"Time scale (Years)"</span>,</span>
<span>       ylab<span class="op">=</span><span class="st">"Seasonal offset (days)"</span>,</span>
<span>       main<span class="op">=</span><span class="st">"Cyclical shifts for May in NNS"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="va">model</span>,lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"orangered"</span><span class="op">)</span></span>
<span>      <span class="va">moys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">subsetCS</span><span class="op">$</span><span class="va">cyclicalShift</span><span class="op">*</span><span class="fl">365</span>,<span class="va">subsetCS</span><span class="op">$</span><span class="va">timeScale</span>,<span class="va">mean</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">moys</span><span class="op">)</span><span class="op">)</span>,y<span class="op">=</span><span class="va">moys</span>,pch<span class="op">=</span><span class="fl">21</span>,type<span class="op">=</span><span class="st">"b"</span>,bg<span class="op">=</span><span class="st">"dodgerblue2"</span>,cex<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-49-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">slopes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sites"</span>,<span class="st">"month"</span>,<span class="st">"slope"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s now show all the trends, first for the SNS:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">slopes</span><span class="op">$</span><span class="va">month</span><span class="op">[</span><span class="va">slopes</span><span class="op">$</span><span class="va">sites</span><span class="op">==</span><span class="st">"SNS"</span><span class="op">]</span><span class="op">*</span><span class="fl">12</span><span class="op">+</span><span class="fl">0.5</span>,</span>
<span>     y<span class="op">=</span><span class="va">slopes</span><span class="op">$</span><span class="va">slope</span><span class="op">[</span><span class="va">slopes</span><span class="op">$</span><span class="va">sites</span><span class="op">==</span><span class="st">"SNS"</span><span class="op">]</span><span class="op">*</span><span class="fl">10</span>,</span>
<span>     las<span class="op">=</span><span class="fl">1</span>,type<span class="op">=</span><span class="st">"b"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Cyclical shift in SNS (days/decade)"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Month"</span><span class="op">)</span></span>
<span><span class="co">#note the multiplication by ten to get a slope in days per decade</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-50-1.png" width="672" style="display: block; margin: auto;"></p>
<p>And then for the NNS:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">slopes</span><span class="op">$</span><span class="va">month</span><span class="op">[</span><span class="va">slopes</span><span class="op">$</span><span class="va">sites</span><span class="op">==</span><span class="st">"NNS"</span><span class="op">]</span><span class="op">*</span><span class="fl">12</span><span class="op">+</span><span class="fl">0.5</span>,</span>
<span>     y<span class="op">=</span><span class="va">slopes</span><span class="op">$</span><span class="va">slope</span><span class="op">[</span><span class="va">slopes</span><span class="op">$</span><span class="va">sites</span><span class="op">==</span><span class="st">"NNS"</span><span class="op">]</span><span class="op">*</span><span class="fl">10</span>,</span>
<span>     las<span class="op">=</span><span class="fl">1</span>,type<span class="op">=</span><span class="st">"b"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Cyclical shift in NNS (days/decade)"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Month"</span><span class="op">)</span></span>
<span><span class="co">#note the multiplication by ten to get a slope in days per decade</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="IntroductionCETA_files/figure-html/unnamed-chunk-51-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The two regions of the North Sea exhibit a similar pattern of
cyclical shift: there is maximal advance (positive shift) in spring and
autumn. The advance computed is not negligible, communities take around
6 to 12 days of advance every decade at those months (at least in term
of composition)!</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Djeghri, Anthony Sturbois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
