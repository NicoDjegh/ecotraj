<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dissimilarities in community data • ecotraj</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dissimilarities in community data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ecotraj</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Ecological Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionETA.html">Introduction to Ecological Trajectory Analysis (ETA)</a></li>
    <li><a class="dropdown-item" href="../articles/TransformingTrajectories.html">Transforming trajectories</a></li>
    <li><a class="dropdown-item" href="../articles/TrajectoryDistanceMetrics.html">Distance metrics for trajectory resemblance</a></li>
    <li><a class="dropdown-item" href="../articles/Dissimilarities.html">Dissimilarities in community data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Stable Isotope Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/SITA.html">Introduction to Stable Isotope Trajectory Analysis (SITA)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cyclical Ecological Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionCETA.html">Introduction to Cyclical Ecological Trajectory Analysis (CETA)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Ecological Quality Assessment</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionEQA.html">Introduction to Ecological Quality Assessment (EQA)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/ecotraj/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Dissimilarities in community data</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres</h4>
            
            <h4 data-toc-skip class="date">2025-06-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/ecotraj/blob/HEAD/vignettes/Dissimilarities.Rmd" class="external-link"><code>vignettes/Dissimilarities.Rmd</code></a></small>
      <div class="d-none name"><code>Dissimilarities.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Some dissimilarity coefficients that are popular in community
ecology, such as the percentage difference (alias Bray-Curtis), have the
drawback of being a non-Euclidean (dissimilarity matrices do not allow a
representation in a Cartesian space), or even semi-metric (i.e. triangle
inequality is not ensured). In order to use these coefficients in
multivariate analyses that require these properties a transformation of
the original space will normally be in order. In this section, we
compare different alternatives and provide some recommendations on this
issue.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/ecotraj/">ecotraj</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: Rcpp</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="effect-of-square-root-on-a-simple-directional-trajectory">2. Effect of square root on a simple directional trajectory<a class="anchor" aria-label="anchor" href="#effect-of-square-root-on-a-simple-directional-trajectory"></a>
</h2>
<p>Here, we use an example of a single synthetic community to illustrate
the effect of square root transformation on a community trajectory. We
begin by defining the species data of the trajectory itself. The dataset
consists of four rows (i.e. surveys) and four columns (species). The
dynamics in this example consist in an constant increase in the number
of individuals of the first species and a corresponding decrease of the
others, while keeping a total abundance of 100 individuals:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="va">spdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>,<span class="fl">30</span>,<span class="fl">20</span>,<span class="fl">15</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">25</span>,<span class="fl">15</span>,<span class="fl">10</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span>,<span class="fl">20</span>,<span class="fl">10</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">15</span>,<span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We now use function <code>vegdist</code> from package
<code>vegan</code> to calculate the Bray-Curtis coefficient:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D</span> <span class="op">=</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://vegandevs.github.io/vegan/reference/vegdist.html" class="external-link">vegdist</a></span><span class="op">(</span><span class="va">spdata</span>, <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/is.metric.html">is.metric</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D</span></span></code></pre></div>
<pre><code><span><span class="co">##      1    2    3</span></span>
<span><span class="co">## 2 0.15          </span></span>
<span><span class="co">## 3 0.30 0.15     </span></span>
<span><span class="co">## 4 0.45 0.30 0.15</span></span></code></pre>
<p>This dissimilarity matrix is a metric, so one would not need any
transformation for trajectory analysis. However, it is a good example to
illustrate the effect of the square root transformation.</p>
<p>We start by defining our trajectories:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span><span class="va">D</span>,<span class="va">sites</span>,<span class="va">surveys</span><span class="op">)</span></span></code></pre></div>
<p>If we draw the resemblance space corresponding to this dissimilarity
matrix we see a straight trajectory:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPCoA</a></span><span class="op">(</span><span class="va">x</span>, survey.labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dissimilarities_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;">
Here we see that Bray-Curtis dissimilarity responds linearly to the
proposed sequence of community dynamics. To confirm this geometry, we
can calculate the geometric properties of the trajectory (i.e. length,
angle between consecutive segments and overall directionality):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryLengths</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     S1   S2   S3 Path</span></span>
<span><span class="co">## 1 0.15 0.15 0.15 0.45</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryAngles</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   S1-S2 S2-S3 mean sd rho</span></span>
<span><span class="co">## 1     0     0    0  0   1</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryDirectionality</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 1 </span></span>
<span><span class="co">## 1</span></span></code></pre>
<p>Angles are 0 degrees and overall directionality is maximum (i.e. 1),
in accordance with the plot and the data. We now proceed to take the
square root of the dissimilarity values, as would be necessary to
achieve a metric (and Euclidean) space in a more complex data set:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqrtD</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span></span>
<span><span class="va">sqrtD</span></span></code></pre></div>
<pre><code><span><span class="co">##           1         2         3</span></span>
<span><span class="co">## 2 0.3872983                    </span></span>
<span><span class="co">## 3 0.5477226 0.3872983          </span></span>
<span><span class="co">## 4 0.6708204 0.5477226 0.3872983</span></span></code></pre>
<p>We redefine our trajectories with the new dissimilarity matrix:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_sqrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span><span class="va">sqrtD</span>,<span class="va">sites</span>,<span class="va">surveys</span><span class="op">)</span></span></code></pre></div>
<p>The transformation increases all dissimilarity values (because the
original values are smaller than 1), but the increase is larger for
smaller values, so the ratio between large dissimilarities and small
dissimilarities decreases. This has an effect on the overall shape of
the trajectory, which surprisingly now looks like:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPCoA</a></span><span class="op">(</span><span class="va">x_sqrt</span>, survey.labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Dissimilarities_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In addition to the distortion observed, the number of dimensions of
the data have increased (i.e the sum of variance explained by the two
axes is 88% &lt; 100%), so we cannot be sure that the angles are well
represented. If we re-calculate the properties of the trajectory taking
into account all dimensions we obtain:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryLengths</a></span><span class="op">(</span><span class="va">x_sqrt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          S1        S2        S3     Path</span></span>
<span><span class="co">## 1 0.3872983 0.3872983 0.3872983 1.161895</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryAngles</a></span><span class="op">(</span><span class="va">x_sqrt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   S1-S2 S2-S3 mean sd rho</span></span>
<span><span class="co">## 1    90    90   90  0   1</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryAngles</a></span><span class="op">(</span><span class="va">x_sqrt</span>, all<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   A1 A2 A3 A4 mean sd rho</span></span>
<span><span class="co">## 1 90 90 90 90   90  0   1</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryDirectionality</a></span><span class="op">(</span><span class="va">x_sqrt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   1 </span></span>
<span><span class="co">## 0.5</span></span></code></pre>
<p>The length of segments and the trajectory have increased, but all
segments are of the same length, in agreement with the original
trajectory. In contrast, the angles are now 90 degrees and the overall
directionality has decreased substantially.</p>
</div>
<div class="section level2">
<h2 id="effect-of-different-transformations-on-more-complex-trajectories">3. Effect of different transformations on more complex
trajectories<a class="anchor" aria-label="anchor" href="#effect-of-different-transformations-on-more-complex-trajectories"></a>
</h2>
<p>Here we use simulated data to compare four transformation
approaches:</p>
<ol style="list-style-type: decimal">
<li>Local transformation of semi-metric dissimilarities (such as the
percentage difference) in every triplet when the triangle inequality is
required. This is done by default in the ETA functions.</li>
<li>Global transformation of dissimilarities, using the square
root.</li>
<li>Global transformation of dissimilarities by using Principal
Coordinates Analysis (classical multidimensional scaling) with
eigenvalue correction.</li>
<li>Global transformation of dissimilarities by using metric
multidimensional scaling (metric MDS).</li>
</ol>
<p>We use simulated dynamics to build another trajectory with more
species (20) and more time steps. We begin by setting the number of time
steps (50) and the size of the community (50 individuals):</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Nsteps</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">CC</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">Nreplace</span> <span class="op">&lt;-</span> <span class="va">CC</span><span class="op">*</span><span class="fl">0.05</span></span></code></pre></div>
<p><code>Nreplace</code> is the number of individuals to be replaced
each time step (5%). Now we define the initial community vector and the
vector with the probabilities of offspring for each species according to
some ecological conditions:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">67</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">poffspring</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.002</span>, <span class="fl">0.661</span> ,<span class="fl">0</span> ,<span class="fl">0</span>, <span class="fl">0.037</span>, <span class="fl">0.281</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.008</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.005</span>, <span class="fl">0.003</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>We can now simulate the dynamics by sequentially applying stochastic
deaths and recruitment:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow<span class="op">=</span><span class="va">Nsteps</span><span class="op">+</span><span class="fl">1</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">=</span> <span class="va">x</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Nsteps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pdeath</span> <span class="op">&lt;-</span><span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co">#Equal probability of dying</span></span>
<span>  <span class="va">deaths</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">Nreplace</span>, <span class="va">pdeath</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">deaths</span>,<span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">offspring</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">Nreplace</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">poffspring</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">offspring</span></span>
<span>  <span class="va">m</span><span class="op">[</span><span class="va">k</span><span class="op">+</span><span class="fl">1</span>, <span class="op">]</span><span class="op">&lt;-</span><span class="va">x</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then we decide how frequently (with respect to the simulated step) a
sample of the community is taken, here every four steps:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">Nsteps</span><span class="op">+</span><span class="fl">1</span>, by<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="co">#Sample every four steps</span></span>
<span><span class="va">mj</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">[</span><span class="va">Sj</span>,<span class="op">]</span></span>
<span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Sj</span><span class="op">)</span></span>
<span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Sj</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we are ready to calculate the Bray-Curtis dissimilarity:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://vegandevs.github.io/vegan/reference/vegdist.html" class="external-link">vegdist</a></span><span class="op">(</span><span class="va">mj</span>,<span class="st">"bray"</span><span class="op">)</span></span></code></pre></div>
<p>In this more complex trajectory, some triangles may not obey the
triangle inequality (depending on the simulation). This can be inspected
using function <code>is.metric</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/is.metric.html">is.metric</a></span><span class="op">(</span><span class="va">D</span>, tol<span class="op">=</span><span class="fl">0.0000001</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>Deviations from a metric space, if they exist, will be small, so that
local transformation of triangles will be very small.</p>
<p>Local transformations are not possible to display trajectories. When
we plot the trajectory using function <code><a href="../reference/trajectoryPlot.html">trajectoryPCoA()</a></code> the
global transformation of principal coordinates analysis (PCoA) with
negative eigenvalue correction is performed. This is fine to display
trajectories, but has problems when measuring angular properties, as we
will see.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span><span class="va">D</span>,<span class="va">sites</span>,<span class="va">surveys</span><span class="op">)</span></span>
<span><span class="va">pcoa</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPCoA</a></span><span class="op">(</span><span class="fu"><a href="../reference/subsetTrajectories.html">subsetTrajectories</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"1"</span><span class="op">)</span>,</span>
<span>                     length<span class="op">=</span><span class="fl">0.1</span>, axes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, survey.labels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in cmdscale(d, eig = TRUE, add = TRUE, k = nrow(as.matrix(d)) - : only</span></span>
<span><span class="co">## 11 of the first 12 eigenvalues are &gt; 0</span></span></code></pre>
<pre><code><span><span class="co">## Warning in arrows(x[niini], y[niini], x[nifin], y[nifin], ...): zero-length</span></span>
<span><span class="co">## arrow is of indeterminate angle and so skipped</span></span></code></pre>
<p><img src="Dissimilarities_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcoaD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">pcoa</span><span class="op">$</span><span class="va">points</span><span class="op">)</span></span>
<span><span class="va">x_pcoa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span><span class="va">pcoaD</span>,<span class="va">sites</span>,<span class="va">surveys</span><span class="op">)</span></span></code></pre></div>
<p>The trajectory has some twists derived from stochasticity in death
and recruitment. Let’s now look at the square root of the Bray-Curtis
dissimilarity:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqrtD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span></span>
<span><span class="va">x_sqrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span><span class="va">sqrtD</span>,<span class="va">sites</span>,<span class="va">surveys</span><span class="op">)</span></span>
<span><span class="va">pcoaSqrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPCoA</a></span><span class="op">(</span><span class="fu"><a href="../reference/subsetTrajectories.html">subsetTrajectories</a></span><span class="op">(</span><span class="va">x_sqrt</span>, <span class="st">"1"</span><span class="op">)</span>,</span>
<span>                          length<span class="op">=</span><span class="fl">0.1</span>, axes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, survey.labels <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in arrows(x[niini], y[niini], x[nifin], y[nifin], ...): zero-length</span></span>
<span><span class="co">## arrow is of indeterminate angle and so skipped</span></span></code></pre>
<p><img src="Dissimilarities_files/figure-html/unnamed-chunk-17-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Finally, we also transform dissimilarities using metric
multidimensional scaling (mMDS), provided by package
<code>smacof</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">smacof</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/smacof/man/smacofSym.html" class="external-link">mds</a></span><span class="op">(</span><span class="va">D</span>, ndim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Sj</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, type <span class="op">=</span> <span class="st">"interval"</span><span class="op">)</span></span>
<span><span class="va">mmdsD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">conf</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/trajectoryPlot.html">trajectoryPlot</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">conf</span>, <span class="va">sites</span>, <span class="va">surveys</span>,</span>
<span>               length<span class="op">=</span><span class="fl">0.1</span>, axes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, survey.labels <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in arrows(xp[niini], yp[niini], xp[nifin], yp[nifin], ...): zero-length</span></span>
<span><span class="co">## arrow is of indeterminate angle and so skipped</span></span></code></pre>
<p><img src="Dissimilarities_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_mmds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span><span class="va">mmdsD</span>,<span class="va">sites</span>,<span class="va">surveys</span><span class="op">)</span></span></code></pre></div>
<p>While the three plots look different, the differences are not
striking (besides rotation issues). We can compare the stress of the
global solutions:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smacof</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/smacof/man/stress0.html" class="external-link">stress0</a></span><span class="op">(</span><span class="va">D</span>,<span class="va">pcoaSqrt</span><span class="op">$</span><span class="va">points</span>, type<span class="op">=</span><span class="st">"interval"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## smacof::stress0(delta = D, init = pcoaSqrt$points, type = "interval")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model: Symmetric SMACOF </span></span>
<span><span class="co">## Number of objects: 13 </span></span>
<span><span class="co">## Stress-1 value: 0.077 </span></span>
<span><span class="co">## Number of iterations: 0</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smacof</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/smacof/man/stress0.html" class="external-link">stress0</a></span><span class="op">(</span><span class="va">D</span>,<span class="va">pcoa</span><span class="op">$</span><span class="va">points</span>, type<span class="op">=</span><span class="st">"interval"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## smacof::stress0(delta = D, init = pcoa$points, type = "interval")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model: Symmetric SMACOF </span></span>
<span><span class="co">## Number of objects: 13 </span></span>
<span><span class="co">## Stress-1 value: 0.007 </span></span>
<span><span class="co">## Number of iterations: 0</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">smacof</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/smacof/man/stress0.html" class="external-link">stress0</a></span><span class="op">(</span><span class="va">D</span>,<span class="va">res</span><span class="op">$</span><span class="va">conf</span>, type<span class="op">=</span><span class="st">"interval"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## smacof::stress0(delta = D, init = res$conf, type = "interval")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model: Symmetric SMACOF </span></span>
<span><span class="co">## Number of objects: 13 </span></span>
<span><span class="co">## Stress-1 value: 0.013 </span></span>
<span><span class="co">## Number of iterations: 0</span></span></code></pre>
<p>Where we see that the square root leads to the strongest alteration
of original dissimilarities. If we calculate geometric properties we are
not limited by ordination plots and we can take into account all
dimensions.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anglesD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryAngles</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">anglesSqrtD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryAngles</a></span><span class="op">(</span><span class="va">x_sqrt</span><span class="op">)</span></span>
<span><span class="va">anglesPcoaD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryAngles</a></span><span class="op">(</span><span class="va">x_pcoa</span><span class="op">)</span></span>
<span><span class="va">anglesmmdsD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryAngles</a></span><span class="op">(</span><span class="va">x_mmds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">anglesD</span>, <span class="va">anglesSqrtD</span>, <span class="va">anglesPcoaD</span>, <span class="va">anglesmmdsD</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"local"</span>, <span class="st">"global.sqrt"</span>, <span class="st">"global.pcoa"</span>, <span class="st">"global.mmds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">df</span>,<span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             S1-S2  S2-S3  S3-S4 S4-S5  S5-S6  S6-S7 S7-S8 S8-S9 S9-S10 S10-S11</span></span>
<span><span class="co">## local        0.00  75.52  82.82  0.00  97.18 104.48  0.00  0.00    NaN     NaN</span></span>
<span><span class="co">## global.sqrt 90.00 101.78 104.48 90.00 104.48 110.70 90.00 90.00    NaN     NaN</span></span>
<span><span class="co">## global.pcoa 80.72  98.29 103.57 77.78 104.99 112.42 91.92 91.92 105.24  102.26</span></span>
<span><span class="co">## global.mmds 54.83  95.78  95.60 44.20  97.89 119.23 72.23 49.85  93.77   92.68</span></span>
<span><span class="co">##             S11-S12  mean   sd  rho</span></span>
<span><span class="co">## local          0.00 38.10 0.83 0.71</span></span>
<span><span class="co">## global.sqrt   90.00 96.81 0.14 0.99</span></span>
<span><span class="co">## global.pcoa   80.72 95.46 0.19 0.98</span></span>
<span><span class="co">## global.mmds   21.88 76.70 0.50 0.88</span></span></code></pre>
<p>The first call to <code><a href="../reference/trajectoryMetrics.html">trajectoryAngles()</a></code> with matrix
<code>D</code> represents the default strategy of transforming triangles
locally, which involves the weakest transformation of all and can be
taken as reference. Both the square root and PCoA with negative
eigenvalue correction induce a strong transformation of trajectory
angles. The global solution of metric MDS leads to angles that are more
similar to those of the local transformation strategy.</p>
<p>If we inspect the overall directionality, the global solution of
metric MDS provides a value that is again closer to that of local
transformation, compared to PCoA and the square root:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryDirectionality</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         1 </span></span>
<span><span class="co">## 0.8770056</span></span></code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryDirectionality</a></span><span class="op">(</span><span class="va">x_sqrt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         1 </span></span>
<span><span class="co">## 0.4810576</span></span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryDirectionality</a></span><span class="op">(</span><span class="va">x_pcoa</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         1 </span></span>
<span><span class="co">## 0.5927582</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trajectoryMetrics.html">trajectoryDirectionality</a></span><span class="op">(</span><span class="va">x_mmds</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         1 </span></span>
<span><span class="co">## 0.7532264</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="conclusions">4. Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>In this small study we compared the effect of different solutions to
violation of the triangle inequality. If function <code>is.metric</code>
returns TRUE for a given data set one should not worry about violations
of the triangle inequality. Local solutions are those that imply the
smallest number of changes, but these will not be consistent across
triplets, so users may desire to apply a global transformation that
produces euclidean spaces. This should be done with care. We have shown
how the square root transformation distorts the angles and overall
directionality of trajectories on the space defined by the percentage
difference (alias Bray-Curtis) dissimilarity index. We suspect that this
negative effect of square root transformation on angles happens no
matter which coefficient is used to derive the initial distance matrix.
Therefore, we advocate for avoiding its use when conducting trajectory
analysis (in particular for angles). The global transformation
consisting in the application of PCoA with negative eigenvalue
correction is less strong than the square root, but it still strongly
change the angles between segments. Perhaps, the less harmful global
transformation is provided by metric Multidimensional Scaling, but the
need to embed distances in an Euclidean space of all three
transformations implies a stronger requirement than being a metric, and
results in distortions.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Djeghri, Anthony Sturbois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
