<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Functions for building Trajectory Sections — trajectorySections • ecotraj</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Functions for building Trajectory Sections — trajectorySections"><meta name="description" content="Trajectory sections are flexible way to cut longer trajectories. They are presently used chiefly in building cycles for cyclical ecological trajectory analysis (CETA) but might have other applications."><meta property="og:description" content="Trajectory sections are flexible way to cut longer trajectories. They are presently used chiefly in building cycles for cyclical ecological trajectory analysis (CETA) but might have other applications."><meta property="og:image" content="https://emf-creaf.github.io/ecotraj/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ecotraj</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Ecological Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionETA.html">Introduction to Ecological Trajectory Analysis (ETA)</a></li>
    <li><a class="dropdown-item" href="../articles/TransformingTrajectories.html">Transforming trajectories</a></li>
    <li><a class="dropdown-item" href="../articles/TrajectoryDistanceMetrics.html">Distance metrics for trajectory resemblance</a></li>
    <li><a class="dropdown-item" href="../articles/Dissimilarities.html">Dissimilarities in community data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Stable Isotope Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/SITA.html">Introduction to Stable Isotope Trajectory Analysis (SITA)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cyclical Ecological Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionCETA.html">Introduction to Cyclical Ecological Trajectory Analysis (CETA)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Ecological Quality Assessment</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionEQA.html">Introduction to Ecological Quality Assessment (EQA)</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/ecotraj/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Functions for building Trajectory Sections</h1>
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/ecotraj/blob/HEAD/R/trajectorySections.R" class="external-link"><code>R/trajectorySections.R</code></a></small>
      <div class="d-none name"><code>trajectorySections.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Trajectory sections are flexible way to cut longer trajectories. They are presently used chiefly in building cycles for cyclical ecological trajectory analysis (CETA) but might have other applications.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extractTrajectorySections</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">Traj</span>,</span>
<span>  <span class="va">tstart</span>,</span>
<span>  <span class="va">tend</span>,</span>
<span>  <span class="va">BCstart</span>,</span>
<span>  <span class="va">BCend</span>,</span>
<span>  namesTS <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Traj</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An object of class <code><a href="defineTrajectories.html">trajectories</a></code> describing a cyclical trajectory.</p></dd>


<dt id="arg-traj">Traj<a class="anchor" aria-label="anchor" href="#arg-traj"></a></dt>
<dd><p>A vector of length equal to the number of desired trajectory sections indicating the trajectories from which trajectory sections must be build (see details).</p></dd>


<dt id="arg-tstart">tstart<a class="anchor" aria-label="anchor" href="#arg-tstart"></a></dt>
<dd><p>A vector of start times for each of the desired trajectory sections (see details).</p></dd>


<dt id="arg-tend">tend<a class="anchor" aria-label="anchor" href="#arg-tend"></a></dt>
<dd><p>A vector of end times for each of the desired trajectory sections (see details).</p></dd>


<dt id="arg-bcstart">BCstart<a class="anchor" aria-label="anchor" href="#arg-bcstart"></a></dt>
<dd><p>A vector of start boundary conditions (either <code>"internal"</code> or <code>"external"</code>) for each of the desired trajectory sections (see details).</p></dd>


<dt id="arg-bcend">BCend<a class="anchor" aria-label="anchor" href="#arg-bcend"></a></dt>
<dd><p>A vector of end boundary conditions (either <code>"internal"</code> or <code>"external"</code>) for each of the desired trajectory sections (see details).</p></dd>


<dt id="arg-namests">namesTS<a class="anchor" aria-label="anchor" href="#arg-namests"></a></dt>
<dd><p>An optional vector giving a name for each of the desired trajectory sections (by default trajectory sections are simply numbered).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Function <code>extractTrajectorySections</code> returns the base information needed to describe trajectory sections. Its outputs are meant to be used as inputs for other ETA functions in order to obtain desired metrics. Importantly, within trajectory sections, ecological states can be considered "internal" or "external" and may necessitate special treatment (see details). Function <code>extractTrajectorySections</code> returns an object of class <code>sections</code> containing:</p><ul><li><p><code>d</code>: an object of class <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></code>, the new distance matrix describing the trajectory sections. Ecological states may be duplicated in this matrix if trajectory sections overlap. As compared to the input matrix, <code>d</code> may also present deletions of ecological states that do not belong to any trajectory sections.</p></li>
<li><p><code>metadata</code>: an object of class <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></code> describing the ecological states in <code>d</code> with columns:
</p><ul><li><p><code>sites</code>: the sites associated to each ecological states.</p></li>
<li><p><code>sections</code>: the names of the trajectory sections each ecological states belongs to.</p></li>
<li><p><code>surveys</code>: renumbering of the surveys to describe individual trajectory sections.</p></li>
<li><p><code>times</code>: the times associated to each ecological states.</p></li>
<li><p><code>internal</code>: a boolean vector with <code>TRUE</code> indicating "internal" ecological states whereas <code>FALSE</code> indicates "external" ecological states. This has important implications for the use of <code>extractTrajectorySections</code> outputs (see details).</p></li>
</ul></li>
<li><p><code>interpolationInfo</code>: an output that only appear if ecological states have been interpolated. It is used internally by plotting functions (see <code>cyclePCoA</code>) but is not intended to be of interest to the end user.</p></li>
</ul><p>Function <code>interpolateEcolStates</code> returns an object of class <code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></code> including the desired interpolated ecological states.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Trajectory sections functions:</p><ul><li><p>Function <code>extractTrajectorySections</code> reformats an object of class <code><a href="defineTrajectories.html">trajectories</a></code> describing one or more trajectories into another object of class <code><a href="defineTrajectories.html">trajectories</a></code> describing specified trajectory sections. Trajectory sections represent a way to subset trajectories flexibly. Cycles (see <code><a href="trajectoryCyclical.html">extractCycles</a></code>) are a particular case of trajectory sections.</p></li>
<li><p>Function <code>interpolateEcolStates</code> compute interpolated ecological states and the new distance matrix associated (used in extractTrajectorySections).</p></li>
</ul><p>Trajectory sections can be obtained using <code>extractTrajectorySections</code>. Trajectory sections allow to cut a longer trajectory into parts for further analyses. Cycles are specical case of trajectory sections.
A trajectory section TS(Traj,(tstart, BCstart),(tend, BCend)) is defined by the trajectory (Traj) it is obtained from, by an start and end times (tstart and tend) and start and end boundary conditions (BCstart, BCend).
The function extractTrajectorySections builds trajectory sections as a function of its arguments <code>Traj</code>, <code>tstart</code>, <code>tend</code>, <code>BCstart</code>, <code>BCend</code>.</p>
<p>Function <code>interpolateEcolStates</code> is called within <code>extractTrajectorySections</code> to interpolate ecological states when <code>tstart</code> and or <code>tend</code> do not have an associated measured ecological state within matrix <code>d</code>.</p>
<p>IMPORTANT: Trajectory sections comprises both "internal" and "external" ecological states (indicated in vector <code>internal</code>, see the output of function <code>extractTrajectorySections</code>).
"external" ecological states need a specific treatment in some calculations and for some operations within ETA, namely:</p><ul><li><p>Centering, where external ecological states must be excluded from computation but included nonetheless in the procedure. This is automatically handled by function <code><a href="transformTrajectories.html">centerTrajectories</a></code>.</p></li>
<li><p>Trajectory variability, where only internal ecological states must be taken in account. This is handled automatically by function <code><a href="trajectoryMetrics.html">trajectoryInternalVariation</a></code>.</p></li>
</ul><p>Special care must also be taken when processing the data through principal coordinate analysis as external ecological states are effectively duplicated or interpolated in the output of <code>extractTrajectorySections</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nicolas Djeghri, UBO</p>
<p>Miquel De Cáceres, CREAF</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Description of sites and surveys</span></span></span>
<span class="r-in"><span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"1"</span>,<span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"2"</span>,<span class="st">"2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span>, <span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">1.5</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co">#Raw data table</span></span></span>
<span class="r-in"><span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow<span class="op">=</span><span class="fl">6</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xy</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">xy</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">xy</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">xy</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">xy</span><span class="op">[</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Draw trajectories</span></span></span>
<span class="r-in"><span><span class="fu"><a href="trajectoryPlot.html">trajectoryPlot</a></span><span class="op">(</span><span class="va">xy</span>, <span class="va">sites</span>, <span class="va">surveys</span>,  </span></span>
<span class="r-in"><span>               traj.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"red"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="trajectorySections-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span>               </span></span>
<span class="r-in"><span><span class="co">#Distance matrix</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          1        2        3        4        5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 1.000000                                    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 2.000000 1.000000                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.500000 1.118034 2.061553                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 1.118034 0.500000 1.118034 1.000000         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 2.236068 1.414214 1.000000 2.061553 1.118034</span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co">#Trajectory data</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">sites</span>, <span class="va">surveys</span>, <span class="va">times</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Cutting some trajectory sections in those trajectories</span></span></span>
<span class="r-in"><span><span class="va">TrajSec</span> <span class="op">&lt;-</span> <span class="fu">extractTrajectorySections</span><span class="op">(</span><span class="va">x</span>,</span></span>
<span class="r-in"><span>                                     Traj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"1"</span>,<span class="st">"2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                     tstart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                     tend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>,<span class="fl">2.5</span>,<span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                     BCstart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"internal"</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                     BCend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"internal"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#extractTrajectorySections() works from distances, </span></span></span>
<span class="r-in"><span><span class="co">#so for representation using trajectoryPlot(),we must first perform a PCoA:</span></span></span>
<span class="r-in"><span><span class="va">Newxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html" class="external-link">cmdscale</a></span><span class="op">(</span><span class="va">TrajSec</span><span class="op">$</span><span class="va">d</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="trajectoryPlot.html">trajectoryPlot</a></span><span class="op">(</span><span class="va">Newxy</span>,</span></span>
<span class="r-in"><span>               sites <span class="op">=</span> <span class="va">TrajSec</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">sections</span>,</span></span>
<span class="r-in"><span>               surveys <span class="op">=</span> <span class="va">TrajSec</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">surveys</span>,</span></span>
<span class="r-in"><span>               traj.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"grey"</span>,<span class="st">"red"</span><span class="op">)</span>,lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="trajectorySections-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Djeghri, Anthony Sturbois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

