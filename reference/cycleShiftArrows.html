<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Displaying cycle shifts — cycleShiftArrows • ecotraj</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Displaying cycle shifts — cycleShiftArrows"><meta name="description" content="Adds arrows representing cyclical shifts (advances/delays) into convergence/divergence plots created using function trajectoryConvergencePlot."><meta property="og:description" content="Adds arrows representing cyclical shifts (advances/delays) into convergence/divergence plots created using function trajectoryConvergencePlot."><meta property="og:image" content="https://emf-creaf.github.io/ecotraj/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ecotraj</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Ecological Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionETA.html">Introduction to Ecological Trajectory Analysis (ETA)</a></li>
    <li><a class="dropdown-item" href="../articles/TransformingTrajectories.html">Transforming trajectories</a></li>
    <li><a class="dropdown-item" href="../articles/TrajectoryDistanceMetrics.html">Distance metrics for trajectory resemblance</a></li>
    <li><a class="dropdown-item" href="../articles/Dissimilarities.html">Dissimilarities in community data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Stable Isotope Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/SITA.html">Introduction to Stable Isotope Trajectory Analysis (SITA)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cyclical Ecological Trajectory Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionCETA.html">Introduction to Cyclical Ecological Trajectory Analysis (CETA)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Ecological Quality Assessment</h6></li>
    <li><a class="dropdown-item" href="../articles/IntroductionEQA.html">Introduction to Ecological Quality Assessment (EQA)</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/ecotraj/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Displaying cycle shifts</h1>
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/ecotraj/blob/HEAD/R/cycleShiftArrows.R" class="external-link"><code>R/cycleShiftArrows.R</code></a></small>
      <div class="d-none name"><code>cycleShiftArrows.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Adds arrows representing cyclical shifts (advances/delays) into convergence/divergence plots created using function <code><a href="trajectoryConvergencePlot.html">trajectoryConvergencePlot</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cycleShiftArrows</span><span class="op">(</span></span>
<span>  <span class="va">cycle.shifts</span>,</span>
<span>  radius <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  top <span class="op">=</span> <span class="st">"between"</span>,</span>
<span>  cycle.shifts.inf.conf <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cycle.shifts.sup.conf <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  arrows.length.mult <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  arrows.lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-cycle-shifts">cycle.shifts<a class="anchor" aria-label="anchor" href="#arg-cycle-shifts"></a></dt>
<dd><p>Cyclical shifts computed for each fixed date trajectory plotted by <code>trajectoryConvergencePlot</code>.</p></dd>


<dt id="arg-radius">radius<a class="anchor" aria-label="anchor" href="#arg-radius"></a></dt>
<dd><p>The radius of the circles representing trajectories. Defaults to 1.</p></dd>


<dt id="arg-top">top<a class="anchor" aria-label="anchor" href="#arg-top"></a></dt>
<dd><p>A string indicating if the top of the plotting area should contain a circle representing a trajectory ("circle"), or should be in between two circles ("between"). Defaults to "between".</p></dd>


<dt id="arg-cycle-shifts-inf-conf">cycle.shifts.inf.conf<a class="anchor" aria-label="anchor" href="#arg-cycle-shifts-inf-conf"></a></dt>
<dd><p>Lower confidence intervals for cyclical shifts.</p></dd>


<dt id="arg-cycle-shifts-sup-conf">cycle.shifts.sup.conf<a class="anchor" aria-label="anchor" href="#arg-cycle-shifts-sup-conf"></a></dt>
<dd><p>Upper confidence intervals for cyclical shifts.</p></dd>


<dt id="arg-arrows-length-mult">arrows.length.mult<a class="anchor" aria-label="anchor" href="#arg-arrows-length-mult"></a></dt>
<dd><p>A multiplication coefficient for the arrows representing cyclical shifts. Attempts an automatic adjustment by default (dividing by max(cycle.shifts)).</p></dd>


<dt id="arg-arrows-lwd">arrows.lwd<a class="anchor" aria-label="anchor" href="#arg-arrows-lwd"></a></dt>
<dd><p>Line width of the arrows. Defaults to 2.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is meant to be used in conjunction with <code><a href="trajectoryConvergencePlot.html">trajectoryConvergencePlot</a></code>, to study fixed-date trajectories convergence/divergence patterns:</p><ul><li><p>First, setting <code>pointy = TRUE</code>, in the call to <code><a href="trajectoryConvergencePlot.html">trajectoryConvergencePlot</a></code>, when the studied trajectories are the outputs of <code><a href="trajectoryCyclical.html">extractFixedDateTrajectories</a></code> allows to suggest cyclicity.</p></li>
<li><p>Second, function <code>cycleShiftArrows</code> allows to represent cyclical shifts by adding arrows to the circles representing trajectories. Clockwise arrows will represent advances, anticlockwise arrows will represent delays. Arrows length is proportional to the cyclical shift provided.
Relevant measures of cyclical shifts have to be computed by the user. A variety of methods may be employed but the outputs of <code><a href="trajectoryCyclical.html">cycleShifts</a></code> cannot be used immediately as they do not directly correspond to the fixed-date trajectories. An example of how to compute relevant
measures of cyclical shifts is provided in <code><a href="trajectoryCyclical.html">cycleShifts</a></code> and in the CETA vignette.
The arguments <code>radius</code> and <code>top</code> in <code>cycleShiftArrows</code> must match those in the corresponding call to <code><a href="trajectoryConvergencePlot.html">trajectoryConvergencePlot</a></code> for proper display.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="trajectoryConvergencePlot.html">trajectoryConvergencePlot</a></code>,<code><a href="trajectoryCyclical.html">cycleShifts</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nicolas Djeghri, UBO</p>
<p>Miquel De Cáceres, CREAF</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">#Load cyclical data (a monthly resolved long-term time series of north sea zooplankton)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"northseaZoo"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Define trajectories</span></span></span>
<span class="r-in"><span><span class="va">traj</span> <span class="op">&lt;-</span> <span class="fu"><a href="defineTrajectories.html">defineTrajectories</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">northseaZoo</span><span class="op">$</span><span class="va">Hellinger</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           times <span class="op">=</span> <span class="va">northseaZoo</span><span class="op">$</span><span class="va">times</span>,</span></span>
<span class="r-in"><span>                           sites <span class="op">=</span> <span class="va">northseaZoo</span><span class="op">$</span><span class="va">sites</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simplify it using only one site</span></span></span>
<span class="r-in"><span><span class="va">traj</span> <span class="op">&lt;-</span> <span class="fu"><a href="subsetTrajectories.html">subsetTrajectories</a></span><span class="op">(</span><span class="va">traj</span>, site_selection <span class="op">=</span> <span class="st">"NNS"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Extract the fixed date trajectories</span></span></span>
<span class="r-in"><span><span class="va">fdT</span> <span class="op">&lt;-</span> <span class="fu"><a href="trajectoryCyclical.html">extractFixedDateTrajectories</a></span><span class="op">(</span><span class="va">traj</span>, cycleDuration <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Make the convergence/divergence plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="trajectoryConvergencePlot.html">trajectoryConvergencePlot</a></span><span class="op">(</span><span class="va">fdT</span>,</span></span>
<span class="r-in"><span>                         type <span class="op">=</span> <span class="st">"pairwise.symmetric"</span>,</span></span>
<span class="r-in"><span>                         radius <span class="op">=</span> <span class="fl">1.2</span>,</span></span>
<span class="r-in"><span>                         alpha.filter <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>                         half.arrows.size <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                         pointy <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                         traj.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span></span>
<span class="r-in"><span>                                        <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Compute the cyclical shifts (this takes a bit of time)</span></span></span>
<span class="r-in"><span><span class="va">CS</span> <span class="op">&lt;-</span> <span class="fu"><a href="trajectoryCyclical.html">cycleShifts</a></span><span class="op">(</span><span class="va">traj</span>, cycleDuration <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Obtain an average cyclical shift for each month (this is not automated by ecotraj, </span></span></span>
<span class="r-in"><span><span class="co">#since many ways to do it can be justified). Here we obtain it as the slope of the regression </span></span></span>
<span class="r-in"><span><span class="co">#line of cyclical shifts (y) on the corresponding time scale (x).</span></span></span>
<span class="r-in"><span><span class="va">averageCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">CS</span><span class="op">$</span><span class="va">dateCS</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">CSmonth</span> <span class="op">&lt;-</span> <span class="va">CS</span><span class="op">[</span><span class="va">CS</span><span class="op">$</span><span class="va">dateCS</span><span class="op">==</span><span class="va">i</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">CSmonth</span><span class="op">$</span><span class="va">cyclicalShift</span><span class="op">~</span><span class="va">CSmonth</span><span class="op">$</span><span class="va">timeScale</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">averageCS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">averageCS</span>,<span class="va">model</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Add the average cyclical shifts to the plot</span></span></span>
<span class="r-in"><span><span class="fu">cycleShiftArrows</span><span class="op">(</span><span class="va">averageCS</span>, radius <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="cycleShiftArrows-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres, Nicolas Djeghri, Anthony Sturbois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

